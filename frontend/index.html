<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöå Smart Bus Route Finder - Sri Lanka</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;background:#0f172a;height:100vh;overflow:hidden}
        .app{display:grid;grid-template-columns:420px 1fr;height:100vh}

        .sidebar{background:#1e293b;display:flex;flex-direction:column;border-right:1px solid #334155;overflow:hidden}
        .header{padding:16px 20px;border-bottom:1px solid #334155;display:flex;align-items:center;gap:12px}
        .header-icon{width:38px;height:38px;background:linear-gradient(135deg,#3b82f6,#06b6d4);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
        .header h1{color:#f1f5f9;font-size:16px;font-weight:700}
        .header-sub{color:#64748b;font-size:11px;font-family:'Space Mono',monospace}
        .status{display:flex;align-items:center;gap:6px;margin-left:auto;font-size:11px;font-family:'Space Mono',monospace}
        .status-dot{width:7px;height:7px;border-radius:50%;animation:pulse 2s infinite}
        .status-dot.on{background:#22c55e}.status-dot.off{background:#ef4444}
        .status.on{color:#22c55e}.status.off{color:#ef4444}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

        .search{padding:16px 20px;border-bottom:1px solid #334155}
        .search-row{position:relative;margin-bottom:10px}
        .search-row label{display:block;color:#64748b;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
        .sinput{width:100%;padding:11px 12px 11px 36px;background:#0f172a;border:2px solid #334155;border-radius:8px;color:#f1f5f9;font-size:14px;font-family:inherit;transition:border .2s}
        .sinput:focus{outline:none;border-color:#3b82f6}
        .sinput::placeholder{color:#475569}
        .search-row .ico{position:absolute;left:12px;bottom:10px;font-size:14px}
        .aclist{position:absolute;top:100%;left:0;right:0;background:#1e293b;border:1px solid #334155;border-radius:0 0 8px 8px;max-height:180px;overflow-y:auto;z-index:100;display:none}
        .aclist.show{display:block}
        .acitem{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;border-bottom:1px solid #0f172a;transition:background .1s}
        .acitem:hover{background:#334155}
        .acitem .badge{min-width:28px;height:24px;background:#3b82f6;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:white;font-family:'Space Mono',monospace}
        .acitem .sname{color:#f1f5f9;font-size:13px}
        .acitem .scoord{color:#64748b;font-size:10px;font-family:'Space Mono',monospace}
        .loc-btn{display:inline-flex;align-items:center;gap:4px;background:none;border:1px dashed #475569;border-radius:6px;color:#3b82f6;font-size:11px;font-weight:600;padding:5px 10px;cursor:pointer;margin-top:4px;transition:all .15s}
        .loc-btn:hover{border-color:#3b82f6;background:rgba(59,130,246,.06)}
        .swap-btn{display:block;width:30px;height:30px;border-radius:50%;border:2px solid #334155;background:#1e293b;color:#94a3b8;font-size:14px;cursor:pointer;margin:-4px auto;position:relative;z-index:5;transition:all .2s;display:flex;align-items:center;justify-content:center}
        .swap-btn:hover{border-color:#3b82f6;color:#3b82f6;transform:rotate(180deg)}
        .go-btn{width:100%;padding:12px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;margin-top:12px;background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;transition:all .2s}
        .go-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,.3)}
        .go-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

        .results{flex:1;overflow-y:auto;padding:0}
        .results::-webkit-scrollbar{width:5px}
        .results::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}
        .empty{text-align:center;padding:50px 20px;color:#64748b}
        .empty .eicon{font-size:40px;margin-bottom:10px}
        .empty h3{color:#94a3b8;font-size:15px;margin-bottom:4px}
        .empty p{font-size:12px}

        .tcard{border-bottom:1px solid #334155;padding:16px 20px;cursor:pointer;transition:background .15s}
        .tcard:hover{background:rgba(59,130,246,.05)}
        .tcard.active{background:rgba(59,130,246,.1);border-left:3px solid #3b82f6}
        .tcard-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .tcard-time{font-size:15px;font-weight:700;color:#f1f5f9}
        .tcard-dur{font-size:13px;color:#94a3b8;font-family:'Space Mono',monospace}
        .tcard-label{font-size:10px;font-weight:600;color:#22c55e;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}

        .seg-strip{display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin-bottom:8px}
        .seg-walk{display:flex;align-items:center;gap:2px;color:#94a3b8;font-size:11px}
        .seg-arrow{color:#475569;font-size:10px}
        .seg-bus{display:flex;align-items:center;gap:3px}
        .bus-badge{padding:2px 8px;border-radius:4px;font-size:11px;font-weight:700;color:white;font-family:'Space Mono',monospace}
        .bus-badge.c0{background:#4285F4}.bus-badge.c1{background:#34A853}.bus-badge.c2{background:#EA8600}
        .bus-badge.c3{background:#EA4335}.bus-badge.c4{background:#7B1FA2}.bus-badge.c5{background:#0097A7}

        .tcard-info{display:flex;gap:16px;font-size:11px;color:#64748b}
        .tcard-info span{display:flex;align-items:center;gap:3px}

        .tcard-detail{display:none;margin-top:12px;border-top:1px solid #334155;padding-top:12px}
        .tcard.active .tcard-detail{display:block}
        .detail-seg{display:flex;gap:12px;padding:6px 0}
        .detail-seg .d-line{width:4px;border-radius:2px;min-height:32px;flex-shrink:0}
        .detail-seg .d-line.walk{background:#94a3b8}
        .detail-seg .d-line.bus{background:#4285F4}
        .detail-seg .d-content{flex:1}
        .detail-seg .d-type{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
        .detail-seg .d-type.walk{color:#94a3b8}
        .detail-seg .d-type.bus{color:#60a5fa}
        .detail-seg .d-text{font-size:12px;color:#cbd5e1}
        .detail-seg .d-sub{font-size:10px;color:#64748b;margin-top:2px}

        .loading{text-align:center;padding:40px}
        .spinner{width:32px;height:32px;border:3px solid #334155;border-top-color:#3b82f6;border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}
        @keyframes spin{to{transform:rotate(360deg)}}

        .map-wrap{position:relative}
        #map{width:100%;height:100vh}

        @media(max-width:900px){
            .app{grid-template-columns:1fr}
            .sidebar{max-height:55vh;overflow-y:auto}
            #map{height:45vh}
        }
    </style>
</head>
<body>
<div class="app">
    <div class="sidebar">
        <div class="header">
            <div class="header-icon">üöå</div>
            <div><h1>Bus Route Finder</h1><div class="header-sub">Sri Lanka Transit</div></div>
            <div class="status" id="status">
                <div class="status-dot off" id="sDot"></div>
                <span id="sTxt">Offline</span>
            </div>
        </div>
        <div class="search">
            <div class="search-row">
                <label>From</label>
                <span class="ico">üìç</span>
                <input class="sinput" id="srcIn" placeholder="Your location..." autocomplete="off">
                <div class="aclist" id="srcAC"></div>
                <button class="loc-btn" onclick="useMyLocation()">üì° My Location</button>
            </div>
            <button class="swap-btn" onclick="swap()">‚áÖ</button>
            <div class="search-row">
                <label>To</label>
                <span class="ico">üéØ</span>
                <input class="sinput" id="dstIn" placeholder="Where to?" autocomplete="off">
                <div class="aclist" id="dstAC"></div>
            </div>
            <button class="go-btn" onclick="findTransit()">üîé Search Bus Routes</button>
        </div>
        <div class="results" id="results">
            <div class="empty">
                <div class="eicon">üó∫Ô∏è</div>
                <h3>Search for a bus route</h3>
                <p>Example: Nugegoda ‚Üí Fort Railway Station</p>
            </div>
        </div>
    </div>
    <div class="map-wrap">
        <div id="map"></div>
    </div>
</div>

<!-- Google Maps JS API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAG0W7RJFWmsTR02I91CmFwTi32Y4Gwp9c&libraries=geometry&callback=initMap" async defer></script>

<script>
const API = 'http://localhost:8080/api';
const COLORS = ['#4285F4','#34A853','#EA8600','#EA4335','#7B1FA2','#0097A7'];

let gmap, stops=[], mapMarkers=[], routeRenderers=[], routeOverlays=[];
let selSrc=null, selDst=null;
let directionsService;

// ==================== GOOGLE MAP INIT ====================
function initMap(){
    gmap = new google.maps.Map(document.getElementById('map'),{
        center:{lat:6.9271,lng:79.8612},
        zoom:12,
        mapTypeControl:true,
        mapTypeControlOptions:{
            style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position:google.maps.ControlPosition.TOP_LEFT,
            mapTypeIds:['roadmap','satellite','terrain','hybrid']
        },
        streetViewControl:true,
        fullscreenControl:true,
        zoomControl:true,
        styles:[] // default Google Maps look
    });

    directionsService = new google.maps.DirectionsService();

    checkAPI();
    loadStops();
    setupAC('srcIn','srcAC','src');
    setupAC('dstIn','dstAC','dst');
}

async function checkAPI(){try{const r=await fetch(API+'/health');setAPI(r.ok)}catch{setAPI(false)}}
function setAPI(on){
    document.getElementById('sDot').className='status-dot '+(on?'on':'off');
    document.getElementById('sTxt').textContent=on?'Online':'Offline';
    document.getElementById('status').className='status '+(on?'on':'off');
}
async function loadStops(){
    try{
        const r=await fetch(API+'/stops');
        stops=await r.json();
        showAllStops();
    }catch(e){console.error(e)}
}

// ==================== SHOW BUS STOPS ON MAP ====================
function showAllStops(){
    mapMarkers.forEach(m=>m.setMap(null));mapMarkers=[];
    const bounds=new google.maps.LatLngBounds();

    stops.forEach(s=>{
        const pos={lat:s.latitude,lng:s.longitude};
        bounds.extend(pos);

        const marker=new google.maps.Marker({
            position:pos,
            map:gmap,
            title:s.name,
            icon:{
                path:google.maps.SymbolPath.CIRCLE,
                scale:6,
                fillColor:'#4285F4',
                fillOpacity:0.9,
                strokeColor:'#fff',
                strokeWeight:2
            }
        });

        const infoWindow=new google.maps.InfoWindow({
            content:`<div style="font-family:'DM Sans',sans-serif;padding:4px">
                <b style="font-size:14px">${s.name}</b><br>
                <span style="color:#666;font-size:12px">ID: ${s.id}</span><br>
                <span style="color:#999;font-size:11px">${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}</span>
            </div>`
        });
        marker.addListener('click',()=>infoWindow.open(gmap,marker));
        mapMarkers.push(marker);
    });

    gmap.fitBounds(bounds,{top:40,right:40,bottom:40,left:40});
}

// ==================== AUTOCOMPLETE ====================
function setupAC(inId,listId,type){
    const inp=document.getElementById(inId),list=document.getElementById(listId);
    inp.addEventListener('input',()=>{
        const q=inp.value.trim().toLowerCase();
        if(q.length<1){list.classList.remove('show');return}
        const m=stops.filter(s=>s.name.toLowerCase().includes(q)||s.id.toLowerCase().includes(q)).slice(0,6);
        if(!m.length){list.classList.remove('show');return}
        list.innerHTML=m.map(s=>`<div class="acitem" data-id="${s.id}"><div class="badge">${s.id}</div><div><div class="sname">${s.name}</div><div class="scoord">${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}</div></div></div>`).join('');
        list.classList.add('show');
        list.querySelectorAll('.acitem').forEach(it=>it.onclick=()=>{
            const st=stops.find(s=>s.id===it.dataset.id);
            inp.value=st.name;list.classList.remove('show');
            if(type==='src')selSrc=st;else selDst=st;
        });
    });
    document.addEventListener('click',e=>{if(!e.target.closest('.search-row'))list.classList.remove('show')});
}

function useMyLocation(){
    if(!navigator.geolocation){alert('Geolocation not supported');return}
    navigator.geolocation.getCurrentPosition(p=>{
        let near=null,md=Infinity;
        stops.forEach(s=>{const d=Math.hypot(s.latitude-p.coords.latitude,s.longitude-p.coords.longitude);if(d<md){md=d;near=s}});
        if(near){document.getElementById('srcIn').value=near.name;selSrc=near}

        // Also show user location on map
        new google.maps.Marker({
            position:{lat:p.coords.latitude,lng:p.coords.longitude},
            map:gmap,
            title:'Your Location',
            icon:{
                path:google.maps.SymbolPath.CIRCLE,
                scale:8,
                fillColor:'#a855f7',
                fillOpacity:1,
                strokeColor:'#fff',
                strokeWeight:3
            }
        });
        gmap.setCenter({lat:p.coords.latitude,lng:p.coords.longitude});
        gmap.setZoom(15);
    },()=>alert('Enable GPS'));
}

function swap(){
    const a=document.getElementById('srcIn'),b=document.getElementById('dstIn');
    const tv=a.value;a.value=b.value;b.value=tv;
    const ts=selSrc;selSrc=selDst;selDst=ts;
}

// ==================== GET ROAD ROUTE VIA GOOGLE DIRECTIONS ====================
function getGoogleRoute(fromLat,fromLng,toLat,toLng){
    return new Promise((resolve)=>{
        directionsService.route({
            origin:{lat:fromLat,lng:fromLng},
            destination:{lat:toLat,lng:toLng},
            travelMode:google.maps.TravelMode.DRIVING
        },(result,status)=>{
            if(status==='OK' && result.routes.length>0){
                // Decode the overview polyline to get path points
                const path=result.routes[0].overview_path;
                resolve(path);
            } else {
                // Fallback: straight line
                resolve([
                    new google.maps.LatLng(fromLat,fromLng),
                    new google.maps.LatLng(toLat,toLng)
                ]);
            }
        });
    });
}

// Get full road route for a bus segment (may have polyline with intermediate stops)
async function getFullBusRoad(seg){
    if(seg.polyline && seg.polyline.length > 1){
        // Route through each intermediate pair
        const allPts=[];
        for(let i=0;i<seg.polyline.length-1;i++){
            const p1=seg.polyline[i], p2=seg.polyline[i+1];
            const pts=await getGoogleRoute(p1[0],p1[1],p2[0],p2[1]);
            if(allPts.length===0) allPts.push(...pts);
            else allPts.push(...pts.slice(1));
        }
        return allPts;
    }
    return await getGoogleRoute(seg.fromLat,seg.fromLng,seg.toLat,seg.toLng);
}

// ==================== FIND TRANSIT ====================
async function findTransit(){
    if(!selSrc||!selDst){alert('Select both locations');return}
    if(selSrc.id===selDst.id){alert('Same location');return}
    document.getElementById('results').innerHTML='<div class="loading"><div class="spinner"></div><p>Finding bus routes...</p></div>';

    try{
        const r=await fetch(`${API}/transit?source=${selSrc.id}&destination=${selDst.id}`);
        const options=await r.json();
        if(options.length>0) renderOptions(options);
        else document.getElementById('results').innerHTML='<div class="empty"><div class="eicon">‚ùå</div><h3>No routes found</h3></div>';
    }catch(e){
        document.getElementById('results').innerHTML='<div class="empty"><div class="eicon">‚ö†Ô∏è</div><h3>API Error</h3><p>Is the backend running?</p></div>';
    }
}

function renderOptions(options){
    const c=document.getElementById('results');
    c.innerHTML=options.map((opt,idx)=>{
        const segStrip=opt.segments.map((seg,si)=>{
            if(seg.type==='walk')return `<span class="seg-walk">üö∂${seg.durationMinutes}m</span>${si<opt.segments.length-1?'<span class="seg-arrow">‚Ä∫</span>':''}`;
            const ci=si%COLORS.length;
            return `<span class="seg-bus">üöå<span class="bus-badge c${ci}">${seg.busNumber}</span></span>${si<opt.segments.length-1?'<span class="seg-arrow">‚Ä∫</span>':''}`;
        }).join('');

        const detail=opt.segments.map((seg,si)=>{
            if(seg.type==='walk')return `<div class="detail-seg"><div class="d-line walk"></div><div class="d-content"><div class="d-type walk">üö∂ Walk ${seg.durationMinutes} min</div><div class="d-text">${seg.fromStop} ‚Üí ${seg.toStop}</div></div></div>`;
            const ci=si%COLORS.length;
            return `<div class="detail-seg"><div class="d-line bus" style="background:${COLORS[ci]}"></div><div class="d-content"><div class="d-type bus">üöå Bus ${seg.busNumber} ¬∑ ${seg.stopCount} stops ¬∑ ${seg.durationMinutes} min</div><div class="d-text">${seg.fromStop} ‚Üí ${seg.toStop}</div><div class="d-sub">${seg.distanceKm} km ¬∑ Rs. ${seg.costRs}</div></div></div>`;
        }).join('');

        return `
        <div class="tcard${idx===0?' active':''}" onclick="selectOpt(${idx})">
            ${idx===0?`<div class="tcard-label">${opt.label}</div>`:''}
            <div class="tcard-top">
                <span class="tcard-time">${opt.departureTime} ‚Äî ${opt.arrivalTime}</span>
                <span class="tcard-dur">${fmtDur(opt.totalDurationMinutes)}</span>
            </div>
            <div class="seg-strip">${segStrip}</div>
            <div class="tcard-info">
                <span>üí∞ Rs.${opt.totalCostRs}</span>
                <span>üìç ${opt.totalStops} stops</span>
                <span>üîÑ ${opt.transfers} transfer${opt.transfers!==1?'s':''}</span>
            </div>
            <div class="tcard-detail">${detail}</div>
        </div>`;
    }).join('');

    window._opts=options;
    drawRoute(options[0]);
}

function selectOpt(idx){
    document.querySelectorAll('.tcard').forEach((c,i)=>c.classList.toggle('active',i===idx));
    drawRoute(window._opts[idx]);
}

function fmtDur(m){if(m<60)return m+' min';return Math.floor(m/60)+'h '+m%60+'m'}

// ==================== DRAW ON GOOGLE MAP ====================
async function drawRoute(opt){
    // Clear previous
    routeOverlays.forEach(o=>o.setMap(null));routeOverlays=[];
    routeRenderers.forEach(r=>r.setMap(null));routeRenderers=[];

    const bounds=new google.maps.LatLngBounds();

    for(let si=0;si<opt.segments.length;si++){
        const seg=opt.segments[si];
        const from=new google.maps.LatLng(seg.fromLat,seg.fromLng);
        const to=new google.maps.LatLng(seg.toLat,seg.toLng);
        bounds.extend(from);bounds.extend(to);

        if(seg.type==='walk'){
            // Walking: dashed line
            const walkLine=new google.maps.Polyline({
                path:[from,to],
                strokeColor:'#666666',
                strokeOpacity:0,
                icons:[{
                    icon:{path:'M 0,-1 0,1',strokeOpacity:0.6,strokeColor:'#888',scale:3},
                    offset:'0',repeat:'12px'
                }],
                map:gmap
            });
            routeOverlays.push(walkLine);
        } else {
            // BUS: Get real road path from Google Directions
            const ci=si%COLORS.length;
            const roadPath=await getFullBusRoad(seg);

            roadPath.forEach(p=>bounds.extend(p));

            // Shadow polyline
            const shadow=new google.maps.Polyline({
                path:roadPath,
                strokeColor:'#000000',
                strokeOpacity:0.2,
                strokeWeight:10,
                map:gmap
            });
            routeOverlays.push(shadow);

            // Main colored polyline (thick, on the road)
            const mainLine=new google.maps.Polyline({
                path:roadPath,
                strokeColor:COLORS[ci],
                strokeOpacity:0.85,
                strokeWeight:7,
                map:gmap
            });
            routeOverlays.push(mainLine);

            // Board marker
            const boardMarker=new google.maps.Marker({
                position:from,
                map:gmap,
                title:'Board: '+seg.fromStop,
                icon:{
                    path:google.maps.SymbolPath.CIRCLE,
                    scale:8,
                    fillColor:COLORS[ci],
                    fillOpacity:1,
                    strokeColor:'#fff',
                    strokeWeight:2
                }
            });
            const boardInfo=new google.maps.InfoWindow({
                content:`<div style="font-family:'DM Sans';padding:4px"><b>üöå Board here</b><br>${seg.fromStop}<br><span style="color:${COLORS[ci]};font-weight:700">Bus ${seg.busNumber}</span></div>`
            });
            boardMarker.addListener('click',()=>boardInfo.open(gmap,boardMarker));
            routeOverlays.push(boardMarker);

            // Alight marker
            const alightMarker=new google.maps.Marker({
                position:to,
                map:gmap,
                title:'Alight: '+seg.toStop,
                icon:{
                    path:google.maps.SymbolPath.CIRCLE,
                    scale:8,
                    fillColor:COLORS[ci],
                    fillOpacity:1,
                    strokeColor:'#fff',
                    strokeWeight:2
                }
            });
            const alightInfo=new google.maps.InfoWindow({
                content:`<div style="font-family:'DM Sans';padding:4px"><b>üîΩ Get off here</b><br>${seg.toStop}<br><span style="color:${COLORS[ci]};font-weight:700">Bus ${seg.busNumber}</span></div>`
            });
            alightMarker.addListener('click',()=>alightInfo.open(gmap,alightMarker));
            routeOverlays.push(alightMarker);

            // Bus number label at midpoint
            const midIdx=Math.floor(roadPath.length/2);
            const midPt=roadPath[midIdx];
            const busLabel=new google.maps.Marker({
                position:midPt,
                map:gmap,
                icon:{
                    url:'data:image/svg+xml;charset=UTF-8,'+encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="28">
                            <rect width="80" height="28" rx="14" fill="${COLORS[ci]}"/>
                            <text x="40" y="18" text-anchor="middle" fill="white" font-family="monospace" font-size="12" font-weight="bold">üöå ${seg.busNumber}</text>
                        </svg>`),
                    scaledSize:new google.maps.Size(80,28),
                    anchor:new google.maps.Point(40,14)
                }
            });
            routeOverlays.push(busLabel);
        }
    }

    // START marker (green)
    if(opt.segments.length>0){
        const first=opt.segments[0];
        const startM=new google.maps.Marker({
            position:{lat:first.fromLat,lng:first.fromLng},
            map:gmap,
            title:'Start',
            icon:{
                path:google.maps.SymbolPath.CIRCLE,
                scale:12,
                fillColor:'#22c55e',
                fillOpacity:1,
                strokeColor:'#fff',
                strokeWeight:3
            },
            zIndex:999
        });
        const startInfo=new google.maps.InfoWindow({content:'<b>üìç Start Point</b>'});
        startM.addListener('click',()=>startInfo.open(gmap,startM));
        routeOverlays.push(startM);

        // END marker (red)
        const last=opt.segments[opt.segments.length-1];
        const endM=new google.maps.Marker({
            position:{lat:last.toLat,lng:last.toLng},
            map:gmap,
            title:'Destination',
            icon:{
                path:google.maps.SymbolPath.CIRCLE,
                scale:12,
                fillColor:'#ef4444',
                fillOpacity:1,
                strokeColor:'#fff',
                strokeWeight:3
            },
            zIndex:999
        });
        const endInfo=new google.maps.InfoWindow({content:'<b>üéØ Destination</b>'});
        endM.addListener('click',()=>endInfo.open(gmap,endM));
        routeOverlays.push(endM);
    }

    gmap.fitBounds(bounds,{top:60,right:60,bottom:60,left:60});
}
</script>
</body>
</html>
