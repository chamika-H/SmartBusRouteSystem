<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöå Advanced Bus Route Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-dijkstra {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-bfs {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-clear {
            background: #f0f0f0;
            color: #333;
            grid-column: span 2;
        }

        .result-section {
            min-height: 400px;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .algorithm-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-dijkstra {
            background: #667eea;
            color: white;
        }

        .badge-bfs {
            background: #f5576c;
            color: white;
        }

        .path-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stop-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stop-number {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .arrow {
            text-align: center;
            color: #667eea;
            font-size: 20px;
            margin: 5px 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .no-result {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-result-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        input[type="checkbox"] {
            width: auto;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöå Advanced Bus Route Planner</h1>
            <p class="subtitle">Find the optimal route using Dijkstra's Algorithm or BFS</p>
        </header>

        <div class="main-content">
            <!-- LEFT PANEL: Input Form -->
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #333;">Plan Your Journey</h2>
                
                <div class="input-group">
                    <label>From (Source)</label>
                    <select id="sourceSelect">
                        <option value="">Select starting point</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>To (Destination)</label>
                    <select id="destSelect">
                        <option value="">Select destination</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Optimize For</label>
                    <select id="modeSelect">
                        <option value="distance">Shortest Distance (km)</option>
                        <option value="time">Fastest Time (minutes)</option>
                        <option value="cost">Lowest Cost (Rs.)</option>
                    </select>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="emergencyMode">
                    <label for="emergencyMode" style="margin-bottom: 0;">Emergency Mode (Safe routes only)</label>
                </div>

                <div class="button-group">
                    <button class="btn-dijkstra" onclick="findRoute('dijkstra')">
                        üéØ Dijkstra
                    </button>
                    <button class="btn-bfs" onclick="findRoute('bfs')">
                        üîç BFS
                    </button>
                    <button class="btn-clear" onclick="clearResults()">
                        Clear Results
                    </button>
                </div>
            </div>

            <!-- RIGHT PANEL: Results -->
            <div class="card result-section">
                <div id="resultContainer">
                    <div class="no-result">
                        <div class="no-result-icon">üó∫Ô∏è</div>
                        <h3>No route selected</h3>
                        <p>Select source and destination to find the best route</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA STRUCTURE ====================
        
        class BusStop {
            constructor(id, name, lat, lng) {
                this.id = id;
                this.name = name;
                this.latitude = lat;
                this.longitude = lng;
            }
        }

        class Edge {
            constructor(destination, distance, time, cost, safe) {
                this.destination = destination;
                this.distance = distance;
                this.time = time;
                this.cost = cost;
                this.safe = safe;
            }
        }

        class Graph {
            constructor() {
                this.adjList = new Map();
            }

            addStop(stop) {
                if (!this.adjList.has(stop)) {
                    this.adjList.set(stop, []);
                }
            }

            addRoute(from, to, distance, time, cost, safe) {
                this.adjList.get(from).push(new Edge(to, distance, time, cost, safe));
            }
        }

        // ==================== INITIALIZE DATA ====================
        
        const graph = new Graph();
        const busStops = [];

        // Create bus stops (using Colombo coordinates as example)
        const stops = [
            new BusStop('A', 'Fort Railway Station', 6.9344, 79.8428),
            new BusStop('B', 'Pettah Market', 6.9387, 79.8550),
            new BusStop('C', 'Kollupitiya Junction', 6.9147, 79.8501),
            new BusStop('D', 'Bambalapitiya', 6.8934, 79.8553),
            new BusStop('E', 'Dehiwala Zoo', 6.8569, 79.8742),
            new BusStop('F', 'Mount Lavinia', 6.8389, 79.8630)
        ];

        // Add stops to graph and populate dropdowns
        stops.forEach(stop => {
            busStops.push(stop);
            graph.addStop(stop);
            
            const option1 = `<option value="${stop.id}">${stop.id} - ${stop.name}</option>`;
            document.getElementById('sourceSelect').innerHTML += option1;
            document.getElementById('destSelect').innerHTML += option1;
        });

        // Add routes (distance in km, time in minutes, cost in Rs., safe boolean)
        graph.addRoute(stops[0], stops[1], 3, 15, 50, true);   // A -> B
        graph.addRoute(stops[1], stops[0], 3, 15, 50, true);   // B -> A
        
        graph.addRoute(stops[0], stops[2], 2, 10, 40, true);   // A -> C
        graph.addRoute(stops[2], stops[0], 2, 10, 40, true);   // C -> A
        
        graph.addRoute(stops[1], stops[3], 4, 20, 60, false);  // B -> D (unsafe)
        graph.addRoute(stops[3], stops[1], 4, 20, 60, false);  // D -> B (unsafe)
        
        graph.addRoute(stops[2], stops[3], 1, 8, 30, true);    // C -> D
        graph.addRoute(stops[3], stops[2], 1, 8, 30, true);    // D -> C
        
        graph.addRoute(stops[3], stops[4], 3, 18, 55, true);   // D -> E
        graph.addRoute(stops[4], stops[3], 3, 18, 55, true);   // E -> D
        
        graph.addRoute(stops[3], stops[5], 5, 25, 70, true);   // D -> F
        graph.addRoute(stops[5], stops[3], 5, 25, 70, true);   // F -> D

        // ==================== DIJKSTRA ALGORITHM ====================
        
        function dijkstra(source, mode, emergencyOnly) {
            const dist = new Map();
            const prev = new Map();
            const unvisited = new Set();

            graph.adjList.forEach((edges, stop) => {
                dist.set(stop, Infinity);
                prev.set(stop, null);
                unvisited.add(stop);
            });

            dist.set(source, 0);

            while (unvisited.size > 0) {
                let current = null;
                let minDist = Infinity;

                unvisited.forEach(stop => {
                    if (dist.get(stop) < minDist) {
                        minDist = dist.get(stop);
                        current = stop;
                    }
                });

                if (current === null || minDist === Infinity) break;
                unvisited.delete(current);

                const edges = graph.adjList.get(current);
                edges.forEach(edge => {
                    if (emergencyOnly && !edge.safe) return;

                    const weight = mode === 'time' ? edge.time : 
                                 mode === 'cost' ? edge.cost : edge.distance;
                    
                    const alt = dist.get(current) + weight;

                    if (alt < dist.get(edge.destination)) {
                        dist.set(edge.destination, alt);
                        prev.set(edge.destination, current);
                    }
                });
            }

            return { dist, prev };
        }

        // ==================== BFS ALGORITHM ====================
        
        function bfs(start, end) {
            const queue = [start];
            const visited = new Map();
            const prev = new Map();

            visited.set(start, 0);
            prev.set(start, null);

            while (queue.length > 0) {
                const current = queue.shift();

                if (current === end) {
                    const path = [];
                    let node = end;
                    while (node) {
                        path.unshift(node);
                        node = prev.get(node);
                    }
                    return { found: true, path, stops: visited.get(end) };
                }

                const edges = graph.adjList.get(current);
                edges.forEach(edge => {
                    if (!visited.has(edge.destination)) {
                        visited.set(edge.destination, visited.get(current) + 1);
                        prev.set(edge.destination, current);
                        queue.push(edge.destination);
                    }
                });
            }

            return { found: false, path: [], stops: -1 };
        }

        // ==================== ROUTE FINDING ====================
        
        function findRoute(algorithm) {
            const sourceId = document.getElementById('sourceSelect').value;
            const destId = document.getElementById('destSelect').value;
            const mode = document.getElementById('modeSelect').value;
            const emergency = document.getElementById('emergencyMode').checked;

            if (!sourceId || !destId) {
                alert('Please select both source and destination!');
                return;
            }

            if (sourceId === destId) {
                alert('Source and destination cannot be the same!');
                return;
            }

            const source = busStops.find(s => s.id === sourceId);
            const dest = busStops.find(s => s.id === destId);

            let result;

            if (algorithm === 'dijkstra') {
                const { dist, prev } = dijkstra(source, mode, emergency);
                
                if (dist.get(dest) === Infinity) {
                    displayNoRoute();
                    return;
                }

                const path = [];
                let current = dest;
                while (current) {
                    path.unshift(current);
                    current = prev.get(current);
                }

                result = {
                    found: true,
                    path: path,
                    total: dist.get(dest),
                    algorithm: 'Dijkstra',
                    mode: mode
                };
            } else {
                const bfsResult = bfs(source, dest);
                
                if (!bfsResult.found) {
                    displayNoRoute();
                    return;
                }

                result = {
                    found: true,
                    path: bfsResult.path,
                    total: bfsResult.stops,
                    algorithm: 'BFS',
                    mode: 'stops'
                };
            }

            displayResult(result);
        }

        // ==================== DISPLAY RESULTS ====================
        
        function displayResult(result) {
            const container = document.getElementById('resultContainer');
            
            const modeLabels = {
                'distance': 'km',
                'time': 'min',
                'cost': 'Rs.',
                'stops': 'transfers'
            };

            let pathHTML = '';
            result.path.forEach((stop, index) => {
                pathHTML += `
                    <div class="stop-item">
                        <div class="stop-number">${index + 1}</div>
                        <div>
                            <strong>${stop.name}</strong>
                            <div style="font-size: 12px; color: #666;">${stop.id}</div>
                        </div>
                    </div>
                `;
                if (index < result.path.length - 1) {
                    pathHTML += '<div class="arrow">‚Üì</div>';
                }
            });

            container.innerHTML = `
                <div class="result-header">
                    <h2 style="color: #333;">Route Found!</h2>
                    <span class="algorithm-badge badge-${result.algorithm.toLowerCase()}">
                        ${result.algorithm}
                    </span>
                </div>
                
                <div class="path-display">
                    ${pathHTML}
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">${result.total}</div>
                        <div class="stat-label">${modeLabels[result.mode]}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${result.path.length}</div>
                        <div class="stat-label">Total Stops</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${result.path.length - 1}</div>
                        <div class="stat-label">Transfers</div>
                    </div>
                </div>
            `;
        }

        function displayNoRoute() {
            document.getElementById('resultContainer').innerHTML = `
                <div class="no-result">
                    <div class="no-result-icon">‚ùå</div>
                    <h3>No Route Found</h3>
                    <p>There is no available path between these locations</p>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('sourceSelect').value = '';
            document.getElementById('destSelect').value = '';
            document.getElementById('emergencyMode').checked = false;
            document.getElementById('resultContainer').innerHTML = `
                <div class="no-result">
                    <div class="no-result-icon">üó∫Ô∏è</div>
                    <h3>No route selected</h3>
                    <p>Select source and destination to find the best route</p>
                </div>
            `;
        }
    </script>
</body>
</html>